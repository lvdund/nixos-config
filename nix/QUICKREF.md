# Quick Reference - Nix on Arch Linux

## Installation

```bash
cd ~/nixos-config/nix
./install-arch.sh
```

## Common Commands

### Home Manager
```bash
# Apply configuration
home-manager switch --flake .#vd
# or use alias
hmswitch

# Edit configuration
nvim ~/.config/nixos-config/nix/configuration.nix
# or use alias
hmedit

# Update packages
nix flake update
home-manager switch --flake .#vd
```

### Nix Package Management
```bash
# Search packages
nix search nixpkgs <package-name>

# Install temporary package
nix shell nixpkgs#<package-name>

# Run package without installing
nix run nixpkgs#<package-name>

# Garbage collection
nix-collect-garbage -d
nix-store --optimize
```

### Docker (with aliases)
```bash
d          # docker
dc         # docker-compose
dps        # docker ps
di         # docker images
dex        # docker exec -it
dlog       # docker logs -f
dprune     # docker system prune -af
```

### Git (with aliases)
```bash
gs         # git status
ga         # git add
gc         # git commit
gp         # git push
gl         # git log --oneline --graph
gd         # git diff
```

### Navigation (Fish shell)
```bash
..         # cd ..
...        # cd ../..
....       # cd ../../..
mkcd       # mkdir and cd into directory
```

### Enhanced Tools
```bash
ls         # lsd (modern ls)
ll         # lsd -la
lt         # lsd --tree
cat        # bat (with syntax highlighting)
```

## i3 Keybindings

### Basic
- `Super + Enter` - Terminal (kitty)
- `Super + d` - App launcher (rofi)
- `Super + Shift + q` - Kill window
- `Super + Shift + r` - Restart i3
- `Super + Shift + e` - Exit i3

### Window Movement (Vim-like)
- `Super + h/j/k/l` - Focus left/down/up/right
- `Super + Shift + h/j/k/l` - Move window

### Layout
- `Super + v` - Split vertically
- `Super + b` - Split horizontally
- `Super + f` - Fullscreen
- `Super + s` - Stacking layout
- `Super + w` - Tabbed layout
- `Super + e` - Toggle split layout

### Workspaces
- `Super + 1-9` - Switch to workspace
- `Super + Shift + 1-9` - Move to workspace

### Floating Windows
- `Super + Shift + Space` - Toggle floating
- `Super + Space` - Toggle focus (tiling/floating)

## Configuration Files

```
~/.config/nixos-config/nix/
├── configuration.nix          # Main config
├── flake.nix                  # Flake definition
├── modules/
│   ├── i3-arch.nix           # i3 configuration
│   ├── docker-arch.nix       # Docker setup
│   ├── fish.nix              # Fish shell
│   └── fonts.nix             # Fonts
├── README.md                  # Full documentation
├── COMPARISON.md              # vs NixOS homepc
├── QUICKREF.md               # This file
└── install-arch.sh           # Installation script
```

## System Services (via pacman/systemd)

### Docker
```bash
sudo systemctl start docker
sudo systemctl enable docker
sudo usermod -aG docker $USER
```

### NetworkManager
```bash
sudo systemctl start NetworkManager
sudo systemctl enable NetworkManager
```

### Display Manager (LightDM)
```bash
sudo systemctl start lightdm
sudo systemctl enable lightdm
```

## Troubleshooting

### Nix command not found
```bash
source /etc/profile.d/nix.sh
```

### Permission issues with Docker
```bash
sudo usermod -aG docker $USER
# Log out and back in
```

### i3 not starting
```bash
# Check .xinitrc
cat ~/.xinitrc
# Should contain: exec i3

# Check X11 logs
cat ~/.local/share/xorg/Xorg.0.log
```

### Home Manager build fails
```bash
# Show detailed error trace
home-manager switch --flake .#vd --show-trace

# Check flake lock
nix flake lock --update-input nixpkgs
```

## File Locations

- **Nix config**: `~/.config/nix/nix.conf`
- **Nix store**: `/nix/store/`
- **Home Manager profile**: `~/.nix-profile/`
- **i3 config**: Generated by Home Manager
- **Fish config**: Generated by Home Manager

## Package Management Philosophy

- **System packages** (via pacman): X11, drivers, system services
- **User packages** (via Nix): Development tools, CLI utilities, applications
- **Hybrid approach**: Use Arch for system, Nix for userland

## Tips

1. **Always test before applying**: Use `--dry-run` flag
2. **Keep configurations in git**: Commit changes to track history
3. **Use garbage collection**: Keep `/nix/store` clean
4. **Pin important packages**: Use flake.lock
5. **Backup configurations**: Keep nixos-config repo synced

## Resources

- [Nix Manual](https://nixos.org/manual/nix/stable/)
- [Home Manager Manual](https://nix-community.github.io/home-manager/)
- [i3 User Guide](https://i3wm.org/docs/userguide.html)
- [Fish Shell Documentation](https://fishshell.com/docs/current/)

---
**Quick start**: `cd ~/nixos-config/nix && ./install-arch.sh`
